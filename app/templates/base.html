
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Title -->
  <title>{% block title %}Goldco CMS{% endblock %}</title>

  <!-- Favicon -->
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Theme Check and Update -->
  <script>
    const html = document.querySelector('html');
    const isLightOrAuto = localStorage.getItem('hs_theme') === 'light' || (localStorage.getItem('hs_theme') === 'auto' && !window.matchMedia('(prefers-color-scheme: dark)').matches);
    const isDarkOrAuto = localStorage.getItem('hs_theme') === 'dark' || (localStorage.getItem('hs_theme') === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches);

    if (isLightOrAuto && html.classList.contains('dark')) html.classList.remove('dark');
    else if (isDarkOrAuto && html.classList.contains('light')) html.classList.remove('light');
    else if (isDarkOrAuto && !html.classList.contains('dark')) html.classList.add('dark');
    else if (isLightOrAuto && !html.classList.contains('light')) html.classList.add('light');
  </script>

  <!-- CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/main.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/resizable-table.css') }}">
</head>

<body class="bg-gray-50 dark:bg-neutral-900" data-user-id="{{ session['user']['id'] if session.get('user') else '' }}">

  {% include 'includes/header.html' %}

  {% include 'includes/sidebar.html' %}

  <!-- ========== MAIN CONTENT ========== -->
  <div class="w-full lg:ps-65">
    <div class="p-4 sm:p-6 space-y-4 sm:space-y-6">

      {% include 'includes/flash.html' %}

      {% block content %}
      {% endblock %}

    </div>
  </div>
  <!-- ========== END MAIN CONTENT ========== -->

  <!-- JS PLUGINS -->
  <script src="{{ url_for('static', filename='assets/js/lodash.min.js') }}"></script>
  <script src="{{ url_for('static', filename='assets/js/apexcharts.min.js') }}"></script>
  <script src="{{ url_for('static', filename='assets/js/helper-apexcharts.js') }}"></script>
  <script src="{{ url_for('static', filename='assets/js/index.js') }}"></script>
  <script src="{{ url_for('static', filename='assets/js/resizable-table.js') }}"></script>

  <!-- Extension Token Button Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const tokenBtn = document.getElementById('getExtensionTokenBtn');
      if (tokenBtn) {
        tokenBtn.addEventListener('click', async function() {
          const btn = this;
          const originalText = btn.innerHTML;

          // Disable button and show loading
          btn.disabled = true;
          btn.innerHTML = '<span class="text-xs">Loading...</span>';

          try {
            // Call API to get token
            const response = await fetch('/api/get-extension-token');
            const data = await response.json();

            if (data.token) {
              // Copy to clipboard
              await navigator.clipboard.writeText(data.token);

              // Show success message
              btn.innerHTML = '<span class="text-xs text-green-600">âœ“ Copied!</span>';

              // Show alert with instructions
              alert('Extension token copied to clipboard!\n\nNext steps:\n1. Right-click the Chrome extension icon\n2. Click "Options"\n3. Paste the token and click "Save Token"\n\nThe token will be valid for 7 days.');

              // Reset button after 2 seconds
              setTimeout(() => {
                btn.disabled = false;
                btn.innerHTML = originalText;
              }, 2000);
            } else {
              throw new Error('Failed to get token');
            }
          } catch (error) {
            console.error('Error getting token:', error);
            btn.innerHTML = '<span class="text-xs text-red-600">Error</span>';
            alert('Error getting extension token. Please try again.');

            // Reset button after 2 seconds
            setTimeout(() => {
              btn.disabled = false;
              btn.innerHTML = originalText;
            }, 2000);
          }
        });
      }
    });
  </script>

</body>
</html>
